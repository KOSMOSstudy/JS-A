# 8주차 JS 스터디 정리

| 장   | 제목               |
| ---- | ------------------ |
| 10장 | 웹 API 서버 만들기 |

## 10장
### 10.1 API 서버 이해하기

- **API(Application Programming Interface)** : 다른 애플리케이션에서 현재 프로그램의 기능을 사용할 수 있게 허용하는 접점을 의미한다.
- **크롤링(crawling)** : 웹 사이트가 자체적으로 제공하는 API가 없거나 API 이용에 제한이 있을 때 사용하는 방법

### 10.2 프로젝트 구조 갖추기

- 도메인을 등록하는 이유는 등록한 도메인에서만 API를 사용할 수 있게 하기 위해서이다. 웹 브라우저에서 요청을 보낼 때, 응답을 하는 곳과 도메인이 다르면 CORS 에러가 발생할 수 있다. 브라우저가 현재 웹 사이트에서 함부로 다른 서버에 접근하는 것을 막는 조치이다.

 

### 10.3 JWT 토큰으로 인증하기

JWT는 JSON Web Token의 약어로, JSON 형식의 데이터를 저장하는 토큰이다. JWT는 다음과 같이 세 부분으로 구성되어 있다. 

- **헤더** : 토큰 종류와 해시 알고리즘 정보가 들어 있다.
- **페이로드** : 토큰의 내용물이 인코딩된 부분이다.
- **시그니처** : 일련의 문자열이며, 시그니처를 통해 토큰이 변조되었는지 여부를 확인할 수 있다.

⇒ JWT는 내용을 볼 수 있기 때문에 민감한 내용을 넣으면 안된다.

**[JWT 토큰의 장점]**

JWT 비밀 킬를 알지 않는 이상 변조가 불가능하다. 변조한 토큰은 시그니처를 비밀 키를 통해 검사할 때 들통난다. 변조할 수 없으므로 내용물이 바뀌지 않았는지 걱정할 필요가 없다. 다시 말하면 내용물을 믿고 사용할 수 있다. 즉, 사용자 이름, 권한 같은 것을 넣어두고 안심하고 사용해도 된다. 단, 외부에 노출되어도 좋은 정보에 한해서이다. 비밀번호를 제외하고 사용자의 이메일이나 사용자의 권한 같은 것들을 넣어두면 데이터베이스 조회 없이도 그 사용자를 믿고 권한을 줄 수 있다. 

**[JWT 토큰의 단점]**

용량이 크다. 내용물이 들어 있으므로 랜덤한 토큰을 사용할 대와 비교해서 용량이 클 수밖에 없다. 매 요청 시 토큰이 오고 가서 데이터양이 증가한다.

* 최근에는 세션을 사용하지 않고 로그인할 수 있기 때문에 JWT 토근을 사용해서 로그인 하는 방법이 많이 사용되고 있다. 

### **10.4 다른 서비스에서 호출하기**

- API를 사용하려면 먼저 사용자 인증을 받아야 하므로 사용자 인증이 원활하게 진행되는지 테스트하는 라우터를 만들어야 한다.
- 토큰이 만료되었을 때 갱신하는 코드를 추가해야 한다는 것을 있지 말자!

### 10.5 SNS API 서버 만들기

자신의 게시글 목록을 불러오는 것이므로 사람마다 결과가 다를 것이다. 또한, NodeBird 앱에 올린 게시글을 가져오는 것이므로 게시글을 올리지 않았다면 아무 정보도 표시되지 않는다. 클라이언트 비밀 키가 유출되면 다른 사람 게시글을 가져갈 수 있으니 항상 조심해야 된다.

### 10.6 사용량 제한 구현하기

일정 기간 내에 API를 사용할 수 있는 횟수를 제한하여 서버의 트래픽을 줄이는 것이 좋다.

**[API 응답 목록]**

- 200 : JSON 데이터이다.
- 401 : 유효하지 않은 토큰이다.
- 410 : 새로운 버전이 나왔다. 새로운 버전을 사용해라.
- 419 : 토큰이 만료되었다.
- 429 : 1분에 한 번만 요청할 수 있다.
- 500~ : 기타 서버 에러

### 10.7 CORS(Cross-Origin Resource Sharing) 이해하기

- 브라우저와 서버의 도메인이 일치하지 않으면, 기본적으로 요청이 차단된다. 이 현상은 브라우저에서 서버로 요청을 보낼 때만 발생하고, 서버에서 서버로 요청을 보낼 때는 발생하지 않는다. 현재 요청을 보내는 클라이언트와 요청을 받는 서버의 도메인이 다른 문제를 CORS 문제라고 부른다.
- CORS 문제를 해결하기 위해서는 응답 헤더에 Access-Control-Allow-Origin 헤더를 넣어야 한다. 이 헤더는 클라이언트 도메인의 요청을 허락하겠다는 뜻을 가지고 있다. res.set 메서드로 직접 넣어도 되지만, npm에는 편하게 설치할 수 있는 패키지가 있다. 그것은 바로 cors이다.

## 10장 핵심 정리

- API는 다른 애플리케이션의 기능을 사용할 수 있게 해주는 창구이다.
- 모바일 서버를 구성할 때 서버를 REST API 방식으로 구현하면 된다.
- API 사용자가 API를 쉽게 사용할 수 있도록 사용 방법, 요청 형식, 응답 내용에 관한 문서를 준비해라
- JWT 토큰의 내용은 공개되며 변조될 수 있다는 것을 기억해라. 단, 시그니처를 확인하면 변조되었는지 체크할 수 있다.
- 토큰을 사용하여 API의 오남용을 막는다. 요청 헤더에 토큰이 있는지를 항상 확인하는 것이 좋다.
- app.use 외에도 router.use를 활용하여 라우터 간에 공통되는 로직을 처리할 수 있다.
- cors나 passport.authenticate처럼 미들웨어 내에서 미들웨어를 실행할 수 있다. 미들웨어를 선택적으로 적용하거나 커스터마이징할 때 이 기법을 사용한다.
- 브라우저와 서버의 도메인이 다르면 요청이 거절된다는 특성(CORS)을 이해한다. 서버와 서버 간의 요청에서는 CORS 문제가 발생하지 않는다.
---
