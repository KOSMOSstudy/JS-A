# 6주차 JS 스터디 정리

| 장  | 제목     |
| --- | -------- |
| 8장 | 몽고디비 |

# 8장

## 8.1 NoSQL vs SQL

- SQL(MySQL) : 규칙에 맞는 데이터 입력, 테이블 간 JOIN 지원, 안정성, 일관성, 용어(테이블, 로우, 컬럼)
- NoSQL(몽고디비) : 자유로운 데이터 입력, 컬렉션 간 JOIN 미지원, 확장성, 가용성, 용어(컬렉션, 다큐먼트, 필드)

## 8.2 몽고디비 설치하기

몽고디비는 공식 사이트에서 내려받을 수 있다. (윈도 / 맥 / 리눅스(우분투))

## 8.3 컴퍼스 설치하기

- 몽고디비는 관리 도구로 컴퍼스를 제공한다. → 컴퍼스도 몽고디비 공식 사이트에서 내려받을 수 있다.
- 컴퍼스를 사용하면 GUI를 통해 데이터를 시각적으로 편리할 수 있어 편리하다. 하지만 꼭 필요하지는 않으며, 콘솔로도 같은 작업을 할 수 있다.

## 8.4 데이터베이스 및 컬렉션 생성하기

- 데이터베이스를 만드는 명령어는 use [데이터베이스명] 이다.
- 데이터베이스 목록을 확인하는 명령어는 show dbs이다.
- 현재 사용 중인 데이터베이스를 확인하는 명령어는 db이다.

## 8.5 CRUD 작업하기

### 8.5.1 create(생성)

- 컬렉션과 컬럼을 정의하지 않아도 되므로 컬렉션에는 아무 데이터나 넣을 수 있다. 이러한 자유로움이 몽고디비의 장점이다. 단, 무엇이 들어올지 모른다는 단점도 있다.
- db.컬렉션명.save(다큐먼트)로 다큐먼트를 생성할 수 있다.

### 8.5.2 read(읽기)

- find({}) : 컬렉션 내의 모든 다큐먼트를 조회하라는 뜻이다.
- 몽고디비는 자바스크립트 객체를 사용해서 명령어 쿼리를 생성해야 하므로 $gt 같은 특수한 연산자가 사용된다.

⇒ 자주 쓰이는 연산자 : $gt(초과), $gte(이상), $ lt(미만), $lte(이하), $ne(같지 않음), $or(또는), $in(배열 요소 중 하나, $or(또는))

- sort 메서드 : 정렬 (-1은 내림차순, 1은 오름차순)
- limit 메서드 : 조회할 다큐먼트 개수를 설정
- skip 메서드 : 다큐먼트 개수를 설정하면서 몇 개를 건너뛸지 설정

### 8.5.3 update(수정)

- $set이라는 연산자는 어떤 필드를 수정할지 정하는 연산자이다.
    
    만약 이 연산자를 사용하지 않고 일반 객체를 넣는다면, 다큐먼트가 통째로 두 뻔째 인수로 주어진 객체로 수정된다. 따라서 일부 필드만 수정하고 싶을 때는 반드시 $set 연산자를 지정해야 한다.
    

### 8.5.4 delete(삭제)

- 삭제할 다큐먼트에 대한 정보가 담긴 객체를 첫 번째 인수로 제공하면 된다. 성공 시 삭제된 개수가 반환된다.

## 8.6 몽구스 사용하기

몽구스는 시퀄라이즈와 달리 ODM이라고 불린다. 몽고디비는 릴레이션이 아니라 다큐먼트를 사용하므로 ORM이 아니라 ODM이다. 

몽고디비 자체가 이미 자바스크립트인데도 굳이 자바스크립트 객체와 매핑하는 이유는 몽고디비에 없어서 불편한 기능들을 몽구스가 보완해주기 때문이다.

### 8.6.1. 몽고디비 연결하기

- 몽고디비는 주소를 사용해 연결한다. 주소 형식은 mongodb://[username:password@]host[:port][/[database][?options]]와 같다. [] 부분은 있어도 되고 없어도 됨을 의미한다.

### 8.6.2 스키마 정의하기

- 몽구스 모듈에서 Schema 생성자를 사용해 스키마를 만든다. 시퀄라이즈에서 모델을 정의하는 것과 비슷하다. 필드를 각각 정의한다.
- 몽구스는 알아서 _id를 기본 키로 생성하므로 _id 필드는 적어줄 필요가 없다. 나머지 필드의 스펙만 입력한다.

### 8.6.3 쿼리 수행하기 → 관련 코드는 책 참고!

- Get /users 와 POST /users 주소로 요청이 들어올 때의 라우터는 각각 사용자를 조회하는 요청과 사용자를 등록하는 요청을 처리한다. GET / 에서도 사용자 데이터를 조회했지만 GET /users에서는 데이터를 JSON 형식으로 반환한다는 점에서 차이가 있다.
- 사용자를 등록할 때는 모델.create 메서드로 저장한다. 정의한 스키마에 부합하지 않는 데이터를 넣었을 때는 몽구스가 에러를 발생시킨다. _id는 자동으로 생성된다.

**[댓글에 관련된 CRUD 라우터 정리]**

- GET /users/:id/comments 라우터는 댓글 다큐먼트를 조회하는 라우터
- POST /comments 라우터는 다큐먼트를 등록하는 라우터
- PATCH /comments/:id 라우터는 다큐먼트를 수정하는 라우터
- DELETE /comments/:id 라우터는 다큐먼트를 삭제하는 라우터

---
